<main class="main-content">
        <div class="product-form-container fade-in">
    <div class="product-form-card">
        <div class="form-header">
            <h1 class="form-title">โ๏ธ ุชุนุฏูู ุงูููุชุฌ</h1>
            <p class="form-subtitle">ูู ุจุชุญุฏูุซ ุจูุงูุงุช ููุชุฌู</p>
        </div>
        
        <% if (error) { %>
            <div class="alert alert-error">
                <i class="error-icon">โ๏ธ</i>
                <%= error %>
            </div>
        <% } %>
        
        <% if (success) { %>
            <div class="alert alert-success">
                <i class="success-icon">โ</i>
                <%= success %>
            </div>
        <% } %>
        
        <form method="POST" action="/edit-product/<%= product.id %>" enctype="multipart/form-data" class="product-form">
            <div class="form-row">
                <div class="form-group">
                    <label for="name" class="form-label">๐ ุนููุงู ุงูููุชุฌ *</label>
                    <input type="text" id="name" name="name" required 
                           class="form-input"
                           placeholder="ุฃุฏุฎู ุนููุงู ูุงุถุญ ูุฌุฐุงุจ ููููุชุฌ"
                           value="<%= product.name %>"
                           maxlength="100">
                </div>
                
                <div class="form-group">
                    <label for="price" class="form-label">๐ฐ ุงูุณุนุฑ (ุฑูุงู) *</label>
                    <input type="number" id="price" name="price" required 
                           class="form-input"
                           placeholder="0.00" 
                           value="<%= product.price %>"
                           min="0" 
                           step="0.01">
                </div>
            </div>
            <div class="form-group">
                <label class="form-label">โจ ุญุงูุฉ ุงูููุชุฌ *</label>
                <div style="display: flex; gap: 20px; padding: 10px 0;">
                    <label style="cursor:pointer;"><input type="radio" name="product_condition" value="used" <%= product.product_condition === 'used' ? 'checked' : '' %> required> ูุณุชุนูู</label>
                    <label style="cursor:pointer;"><input type="radio" name="product_condition" value="new" <%= product.product_condition === 'new' ? 'checked' : '' %> required> ุฌุฏูุฏ</label>
                </div>
            </div>
            <!-- ======== ุงูุชูุช ุงูุฅุถุงูุฉ ======== -->

           
            <div class="form-group">
                <label for="category_id" class="form-label">๐ท๏ธ ุงูุชุตููู</label>
                <select id="category_id" name="category_id" class="form-select">
                    <option value="">ุงุฎุชุฑ ุงูุชุตููู ุงูููุงุณุจ</option>
                    <% categories.forEach(category => { %>
                        <option value="<%= category.id %>" <%= product.category_id == category.id ? 'selected' : '' %>>
                            <% if (category.name === 'ุฅููุชุฑูููุงุช') { %>๐ฑ<% } %>
                            <% if (category.name === 'ููุงุจุณ') { %>๐<% } %>
                            <% if (category.name === 'ููุฒู ูุญุฏููุฉ') { %>๐<% } %>
                            <% if (category.name === 'ุณูุงุฑุงุช') { %>๐<% } %>
                            <% if (category.name === 'ูุชุจ') { %>๐<% } %>
                            <% if (category.name === 'ุฑูุงุถุฉ') { %>โฝ<% } %>
                            <% if (category.name === 'ุฃุฎุฑู') { %>๐ฆ<% } %>
                            <%= category.name %>
                        </option>
                    <% }); %>
                </select>
            </div>
            
            <div class="form-group">
                <label for="description" class="form-label">๐ ูุตู ุงูููุชุฌ</label>
                <textarea id="description" name="description" 
                          class="form-textarea"
                          placeholder="ุงูุชุจ ูุตูุงู ููุตูุงู ููููุชุฌ (ุงูุญุงูุฉุ ุงูููุงุตูุงุชุ ุงููููุฒุงุชุ ุฅูุฎ)"
                          maxlength="500"><%= product.description || '' %></textarea>
                <small class="form-hint">ุงููุตู ุงุฎุชูุงุฑู ููููู ูุณุงุนุฏ ูู ุฌุฐุจ ุงููุดุชุฑูู ูุฒูุงุฏุฉ ุงูุซูุฉ</small>
            </div>
            <!-- ======== ุจุฏุงูุฉ ุญูู ุฑุงุจุท ุงูููุฏูู ======== -->
<div class="form-group">
    <label for="youtube_link" class="form-label">๐ฅ ุฑุงุจุท ููุฏูู ููุชููุจ (ุงุฎุชูุงุฑู)</label>
    <input type="url" id="youtube_link" name="youtube_link" 
           class="form-input"
           value="<%= product.youtube_link || '' %>"
           placeholder="https://www.youtube.com/watch?v=...">
</div>
            <div class="form-group">
                <label class="form-label">๐ธ ุตูุฑ ุงูููุชุฌ</label>
                
          <% if (product.image_path) { %>
    <div class="current-image-container">
        <span class="current-image-label">ุงูุตูุฑุฉ ุงูุญุงููุฉ ููููุชุฌ</span>
        <div class="current-image-wrapper">
            <img src="/uploads/<%= product.image_path %>" alt="<%= product.title %>" class="current-product-image">
            <button type="button" class="delete-image-btn" onclick="deleteCurrentImage('<%= product.image_path %>')" title="ุญุฐู ุงูุตูุฑุฉ">
                ๐๏ธ
            </button>
        </div>
    </div>
<% } %>
                
            <div class="file-upload-area">
    <input type="file" id="image" name="image" 
           accept="image/jpeg,image/jpg,image/png,image/gif"
           class="file-input">
    <div class="file-upload-text">
        <i class="upload-icon">๐</i>
        <span><strong>ุงุณุชุจุฏุงู ุงูุตูุฑุฉ ุงูุญุงููุฉ</strong></span>
        <span>ุงุถุบุท ููุง ุฃู ุงุณุญุจ ุตูุฑุฉ ุฌุฏูุฏุฉ ูุงุณุชุจุฏุงู ุงููุฏููุฉ</span>
        <small>ุณูุชู ุญุฐู ุงูุตูุฑุฉ ุงููุฏููุฉ ุชููุงุฆูุงู</small>
    </div>
</div>
                <div id="imagePreview" class="image-preview"></div>
                
               
            </div>
            
            <div class="form-actions">
<button type="submit" class="btn btn-primary btn-large" onclick="showLoadingOverlay()">
                        <i class="btn-icon">๐พ</i>
                    ุญูุธ ุงูุชุบููุฑุงุช
                </button>
                <a href="/my-products" class="btn btn-secondary btn-large">
                    <i class="btn-icon">โฉ๏ธ</i>
                    ุฅูุบุงุก
                </a>
            </div>
        </form>
    </div>
</div>


<script>
// ุชุญุฏูุฏ ุงูุนูุงุตุฑ ุจุงุณุชุฎุฏุงู ุงูู ID ุงูุตุญูุญ
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // --- ุนูุงุตุฑ ุงูุชุญูู ูู ุฑูุน ุงูุตูุฑ ---
        const imageInput = document.getElementById('image');
        const imagePreview = document.getElementById('imagePreview'); // ุญุงููุฉ ุงููุนุงููุฉ
        const fileUploadArea = document.querySelector('.file-upload-area');

        imageInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;

            if (file.size > 5 * 1024 * 1024) { // 5MB
                alert('โ๏ธ ุญุฌู ุงูุตูุฑุฉ ูุจูุฑ ุฌุฏุงู. ูุฑุฌู ุงุฎุชูุงุฑ ุตูุฑุฉ ุฃุตุบุฑ ูู 5 ููุฌุงุจุงูุช.');
                e.target.value = '';
                return;
            }

            const reader = new FileReader();
            reader.onload = function(event) {
                // ูุนุฑุถ ุงููุนุงููุฉ ูู ุงูุญุงููุฉ ุงููุฎุตุตุฉ ููุง
                imagePreview.innerHTML = `
                    <div class="preview-container">
                        <img src="${event.target.result}" alt="ูุนุงููุฉ ุงูุตูุฑุฉ ุงูุฌุฏูุฏุฉ" class="preview-image">
                        <p class="preview-text">โ ุตูุฑุฉ ุฌุฏูุฏุฉ ุฌุงูุฒุฉ ููุงุณุชุจุฏุงู</p>
                    </div>
                `;
            };
            reader.readAsDataURL(file);
        });

        // --- ุชุญุณูู ุชุฌุฑุจุฉ ุงูุณุญุจ ูุงูุฅููุงุช ---
        fileUploadArea.addEventListener('dragover', (e) => e.preventDefault());
        fileUploadArea.addEventListener('dragleave', (e) => e.preventDefault());
        fileUploadArea.addEventListener('drop', function(e) {
            e.preventDefault();
            if (e.dataTransfer.files.length > 0) {
                imageInput.files = e.dataTransfer.files;
                imageInput.dispatchEvent(new Event('change'));
            }
        });
        
        fileUploadArea.addEventListener('click', function(e) {
            if (e.target.tagName.toLowerCase() !== 'input') {
                imageInput.click();
            }
        });
        
        // --- ุฅุธูุงุฑ ุดุงุดุฉ ุงูุชุญููู ุนูุฏ ุฅุฑุณุงู ุงููููุฐุฌ ---
        const productForm = document.querySelector('.product-form');
        if (productForm) {
            productForm.addEventListener('submit', function() {
                const loadingOverlay = document.getElementById('loadingOverlay');
                if (loadingOverlay) {
                    loadingOverlay.classList.add('visible');
                }
            });
        }
    });

    // --- ุฏูุงู ุงูุชุญูู ูู ุงูุตูุฑ (ุชุจูู ุฎุงุฑุฌ DOMContentLoaded) ---
    function deleteCurrentImage(imagePath) {
        if (confirm('ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ูุฐู ุงูุตูุฑุฉุ ุณูุชู ุญุฐููุง ููุงุฆูุงู.')) {
            fetch('/delete-product-image', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ 
                    productId: <%= product.id %>,
                    imagePath: imagePath 
                })
            })
            .then(res => res.json())
            .then(data => {
                if (data.success) {
                    location.reload();
                } else {
                    alert('ุญุฏุซ ุฎุทุฃ ูู ุญุฐู ุงูุตูุฑุฉ');
                }
            })
            .catch(err => {
                console.error('Delete Image Error:', err);
                alert('ุญุฏุซ ุฎุทุฃ ููู');
            });
        }
    }
    
</script>
</script>
    </main>