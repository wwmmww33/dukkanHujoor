<main class="main-content">
        <div class="container">
            <div class="edit-profile-container fade-in">
                <div class="page-header">
                    <h1 class="page-title">âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</h1>
                    <p class="page-subtitle">Ù‚Ù… Ø¨ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ù„ÙˆÙ…Ø§ØªÙƒ Ø§Ù„Ø´Ø®ØµÙŠØ©</p>
                </div>
                
                <% if (typeof error !== 'undefined' && error) { %>
                    <div class="alert alert-error">
                        <i class="alert-icon">âš ï¸</i>
                        <span><%= error %></span>
                    </div>
                <% } %>
                
                <% if (typeof success !== 'undefined' && success) { %>
                    <div class="alert alert-success">
                        <i class="alert-icon">âœ…</i>
                        <span><%= success %></span>
                    </div>
                <% } %>
                
                <form action="/edit-profile" method="POST" enctype="multipart/form-data" class="edit-profile-form">
                    <!-- ØµÙˆØ±Ø© Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ -->
                    <div class="form-section">
                        <h3 class="section-title">ğŸ“· Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø´Ø®ØµÙŠØ©</h3>
                        <div class="avatar-upload-section">
                            <div class="current-avatar">
                                <% if (user.avatar) { %>
                                    <img src="/uploads/<%= user.avatar %>" alt="ØµÙˆØ±Ø© Ø´Ø®ØµÙŠØ©" class="avatar-preview" id="avatarPreview">
                                <% } else { %>
                                    <div class="avatar-placeholder" id="avatarPreview">
                                        <i class="avatar-icon">ğŸ‘¤</i>
                                    </div>
                                <% } %>
                            </div>
                            <div class="avatar-upload-controls">
                                <input type="file" id="avatar" name="avatar" accept="image/*" class="file-input">
                                <label for="avatar" class="btn btn-secondary">
                                    ğŸ“ Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©
                                </label>
                                <% if (user.avatar) { %>
                                    <button type="button" class="btn btn-outline btn-sm" onclick="removeAvatar()">
                                        ğŸ—‘ï¸ Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØµÙˆØ±Ø©
                                    </button>
                                <% } %>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© -->
                    <div class="form-section">
                        <h3 class="section-title">ğŸ‘¤ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="name" class="form-label">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label>
                                <input type="text" id="name" name="name" value="<%= user.name %>" class="form-input" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="phone" class="form-label">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
                                <div style="position: relative;">
                                    <span style="position: absolute; left: 10px; top: 50%; transform: translateY(-50%); color: #666; font-size: 14px; z-index: 1;">+968</span>
                                    <input type="tel" id="phone" name="phone" value="<%= user.phone %>" class="form-input" required readonly style="padding-left: 60px; background-color: #f8f9fa;">
                                </div>
                                <small class="form-help">Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØºÙŠÙŠØ± Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</small>
                            </div>
                            
                            <div class="form-group full-width">
                                <label for="email" class="form-label">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                                <input type="email" id="email" name="email" value="<%= user.email || '' %>" class="form-input" placeholder="example@email.com">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Ø§Ù„Ù†Ø¨Ø°Ø© Ø§Ù„Ø´Ø®ØµÙŠØ© -->
                    <div class="form-section">
                        <h3 class="section-title">ğŸ“ Ø§Ù„Ù†Ø¨Ø°Ø© Ø§Ù„Ø´Ø®ØµÙŠØ©</h3>
                        <div class="form-group">
                            <label for="bio" class="form-label">Ù†Ø¨Ø°Ø© Ø¹Ù†Ùƒ</label>
                            <textarea id="bio" name="bio" class="form-textarea" rows="4" maxlength="500" placeholder="Ø§ÙƒØªØ¨ Ù†Ø¨Ø°Ø© Ù…Ø®ØªØµØ±Ø© Ø¹Ù† Ù†ÙØ³Ùƒ Ø£Ùˆ Ø¹Ù† Ù…ØªØ¬Ø±Ùƒ..."><%= user.bio || '' %></textarea>
                            <div class="char-counter">
                                <span id="bioCounter">0</span>/500 Ø­Ø±Ù
                            </div>
                        </div>
                    </div>
                    
                    <!-- ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± -->
                    <div class="form-section">
                        <h3 class="section-title">ğŸ”’ ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="currentPassword" class="form-label">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø­Ø§Ù„ÙŠØ©</label>
                                <input type="password" id="currentPassword" name="currentPassword" class="form-input" placeholder="Ø§ØªØ±ÙƒÙ‡ ÙØ§Ø±ØºØ§Ù‹ Ø¥Ø°Ø§ Ù„Ù… ØªØ±Ø¯ ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
                            </div>
                            
                            <div class="form-group">
                                <label for="newPassword" class="form-label">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</label>
                                <input type="password" id="newPassword" name="newPassword" class="form-input" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©">
                            </div>
                            
                            <div class="form-group full-width">
                                <label for="confirmPassword" class="form-label">ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</label>
                                <input type="password" id="confirmPassword" name="confirmPassword" class="form-input" placeholder="Ø£Ø¹Ø¯ ÙƒØªØ§Ø¨Ø© ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø­ÙØ¸ ÙˆØ§Ù„Ø¥Ù„ØºØ§Ø¡ -->
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary btn-lg">
                            ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª
                        </button>
                        <a href="/profile" class="btn btn-outline btn-lg">
                            âŒ Ø¥Ù„ØºØ§Ø¡
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </main>
    
    <footer class="footer">
        <div class="footer-content">
            <p>&copy; 2024 Ø¯ÙƒØ§Ù† Ø§Ù„Ø­Ø¬ÙˆØ±. Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©.</p>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø£Ø­Ø±Ù Ù„Ù„Ù†Ø¨Ø°Ø© Ø§Ù„Ø´Ø®ØµÙŠØ©
            const bioTextarea = document.getElementById('bio');
            const bioCounter = document.getElementById('bioCounter');
            
            function updateBioCounter() {
                const length = bioTextarea.value.length;
                bioCounter.textContent = length;
                
                if (length > 450) {
                    bioCounter.style.color = '#e74c3c';
                } else if (length > 400) {
                    bioCounter.style.color = '#f39c12';
                } else {
                    bioCounter.style.color = '#27ae60';
                }
            }
            
            bioTextarea.addEventListener('input', updateBioCounter);
            updateBioCounter(); // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
            
            // Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©
            const avatarInput = document.getElementById('avatar');
            const avatarPreview = document.getElementById('avatarPreview');
            
            avatarInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        avatarPreview.innerHTML = `<img src="${e.target.result}" alt="Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØµÙˆØ±Ø©" class="avatar-preview">`;
                    };
                    reader.readAsDataURL(file);
                }
            });
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ·Ø§Ø¨Ù‚ ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ±
            const newPassword = document.getElementById('newPassword');
            const confirmPassword = document.getElementById('confirmPassword');
            const currentPassword = document.getElementById('currentPassword');
            
            function validatePasswords() {
                if (newPassword.value && confirmPassword.value) {
                    if (newPassword.value !== confirmPassword.value) {
                        confirmPassword.setCustomValidity('ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚Ø©');
                    } else {
                        confirmPassword.setCustomValidity('');
                    }
                }
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ø¹Ù†Ø¯ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø¬Ø¯ÙŠØ¯Ø©
                if (newPassword.value && !currentPassword.value) {
                    currentPassword.setCustomValidity('ÙŠØ¬Ø¨ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø­Ø§Ù„ÙŠØ©');
                } else {
                    currentPassword.setCustomValidity('');
                }
            }
            
            newPassword.addEventListener('input', validatePasswords);
            confirmPassword.addEventListener('input', validatePasswords);
            currentPassword.addEventListener('input', validatePasswords);
            
            // ØªÙ†Ø³ÙŠÙ‚ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ
            const phoneInput = document.getElementById('phone');
            phoneInput.addEventListener('input', function(e) {
                let value = e.target.value.replace(/\D/g, '');
                if (value.startsWith('966')) {
                    value = value.substring(3);
                }
                if (value.length > 0) {
                    value = '+966 ' + value;
                }
                e.target.value = value;
            });
        });
        
        // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø´Ø®ØµÙŠØ©
        function removeAvatar() {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø´Ø®ØµÙŠØ©ØŸ')) {
                const avatarPreview = document.getElementById('avatarPreview');
                avatarPreview.innerHTML = '<i class="avatar-icon">ğŸ‘¤</i>';
                avatarPreview.className = 'avatar-placeholder';
                
                // Ø¥Ø¶Ø§ÙØ© Ø­Ù‚Ù„ Ù…Ø®ÙÙŠ Ù„Ø¥Ø´Ø§Ø±Ø© Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØµÙˆØ±Ø©
                const form = document.querySelector('.edit-profile-form');
                let removeInput = document.getElementById('removeAvatar');
                if (!removeInput) {
                    removeInput = document.createElement('input');
                    removeInput.type = 'hidden';
                    removeInput.name = 'removeAvatar';
                    removeInput.id = 'removeAvatar';
                    form.appendChild(removeInput);
                }
                removeInput.value = 'true';
            }
        }
    </script>
</main>